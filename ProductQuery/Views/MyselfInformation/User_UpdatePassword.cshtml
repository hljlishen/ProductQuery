@model ProductQuery.Models.User
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/templatemo-style.css" rel="stylesheet" />
    <link href="~/Content/css/fontawesome.min.css" rel="stylesheet" />
    <script src="~/Content/js/jquery-3.3.1.min.js"></script>
    <script src="~/Content/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        function validate(oldpassword) {
            var validate = true;

            var confirmoldpassword = $("#confirmoldpassword").val();
            var newpassword = $("#newpassword").val();
            var confirmnewpassword = $("#confirmnewpassword").val();

            if (oldpassword != confirmoldpassword) {
                $("#erroroldpassword").css("color", "red");
                $("#erroroldpassword").attr("class", "glyphicon glyphicon-remove");
                $("#erroroldpassword").html("*旧密码输入错误");
                validate = false;
            } else {
                $("#erroroldpassword").css("color", "green");
                $("#erroroldpassword").attr("class", "glyphicon glyphicon-ok");
                $("#erroroldpassword").html("");
            }

            if (newpassword == "") {
                $("#errornewpassword").css("color", "red");
                $("#errornewpassword").attr("class", "glyphicon glyphicon-remove");
                $("#errornewpassword").html("*密码不能为空");
                validate = false;
            } else {
                $("#errornewpassword").css("color", "green");
                $("#errornewpassword").attr("class", "glyphicon glyphicon-ok");
                $("#errornewpassword").html("");
            }

            if (newpassword.length < 6) {
                $("#errornewpassword").css("color", "red");
                $("#errornewpassword").attr("class", "glyphicon glyphicon-remove");
                $("#errornewpassword").html("*密码长度不能小于6位");
                validate = false;
            } else {
                $("#errornewpassword").css("color", "green");
                $("#errornewpassword").attr("class", "glyphicon glyphicon-ok");
                $("#errornewpassword").html("");
            }

            if (newpassword != confirmnewpassword) {
                $("#errorconfirmnewpassword").css("color", "red");
                $("#errorconfirmnewpassword").attr("class", "glyphicon glyphicon-remove");
                $("#errorconfirmnewpassword").html("*两次输入密码不一致");
                validate = false;
            } else {
                $("#errorconfirmnewpassword").css("color", "green");
                $("#errorconfirmnewpassword").attr("class", "glyphicon glyphicon-ok");
                $("#errorconfirmnewpassword").html("");
            }

            if (validate) {
                update();
            }
        }

        function update() {
            $.ajax({
                url: "@Url.Action("User_update","AdminUser")",
                type: "post",
                data: $("form").serialize(),
                dataType: "json",
                success: function (data) {
                    data = eval("(" + data + ")");
                    if (data) {
                        alert("修改成功");
                    } else {
                        alert("修改失败");
                    }
                    parent.closeWin();
                }
            });
        }
    </script>

</head>
<body>
    <div class="row tm-content-row">
        <div class="tm-block-col tm-col-account-settings">
            <div class="tm-bg-primary-dark tm-block tm-block-settings">
                @using (Html.BeginForm(new { @class = "tm-signup-form row", role = "form" }))
                {
                    @Html.HiddenFor(user => user.id)
                    @Html.HiddenFor(user => user.name)
                    @Html.HiddenFor(user => user.Phone)
                    @Html.HiddenFor(user => user.permissions)
                    <div class="form-group col-lg-6">
                        <label>请输入旧密码</label>
                        <input id="confirmoldpassword" type="password" class="form-control validate" />
                        <span style="color: red;" id="erroroldpassword"></span>
                    </div>

                    <div class="form-group col-lg-6">
                        <label>请输入新密码</label>
                        @Html.PasswordFor(user => user.password, new { @class = "form-control validate", id = "newpassword" })
                        <span style="color: red;" id="errornewpassword"></span>
                    </div>

                    <div class="form-group col-lg-6">
                        <label>确认密码</label>
                        @Html.PasswordFor(user => user.ConfirmPassword, new { @class = "form-control validate", id = "confirmnewpassword" })
                        <span style="color: red;" id="errorconfirmnewpassword"></span>
                    </div>

                    <div class="form-group col-lg-6">
                        <label class="tm-hide-sm">&nbsp;</label>
                        <button type="button" class="btn btn-primary btn-block text-uppercase" onclick="validate('@ViewData["oldpassword"]');">
                            更新我的密码
                        </button>
                    </div>
                }
            </div>
        </div>
    </div>
</body>
</html>
